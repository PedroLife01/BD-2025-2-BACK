<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- vscode Session 30c7a752-5b58-487d-bea6-d6ec8bf2da2c (2025-12-03 19:47Z) -->

# Project plan for SIGEA backend development (2025-12-03 19:47Z)

_**User (2025-12-03 19:53Z)**_

Estou construindo um back-end em node e postgresql para esse meu projeto de banco de dados.


temos nosso pdf de especificacao do trabalho e tema escolhido #file:BD_2025.pdf, temos nosso .sql que vai gerar o banco, temos aqui nossa img do nosso modelo relacional #file:MODELO-RELACIOAL.png e nosso modelo de entidade #file:modeloentidaderelacionamentobd.drawio.png.

Com base nisso precisamos então montar um plano para o desenvolvimento do nosso projeto de forma simples, sem coisas MT complexas, coisas tranquilas e funcionais, de modo que ao final esses requisitos do projeot sejam cumpirdos

Partes do Projeto para apresentação em sala (no máximo 15 minutos por grupo):
• O grupo deve começar a apresentação com apenas um dos modelos: Modelo de
Entidade Relacionamento ou Modelo Relacional.
• O banco de dados criado no SGBD escolhido pelo grupo com os 5 registros. Abrir as
tabelas do banco para mostrar
• O CRUD (Create Read Update Delete) funcionando para um conjunto de no mínimo
3 tabelas com relacionamento entre elas.
• O código fonte do CRUD
• A implementação da camada de persistência
• A view funcionando.
• A procedure funcionando
• A trigger funcionando.
• Inserção de um dado binário no banco, pode ser foto, arquivo PDF ou outro tipo de
arquivo.
Pode usar ferramentas de IA (ChatGPT, Gemini, e etc), mas apresentar onde e como usou


---

_**Agent (model copilot/claude-opus-4.5)**_

<tool-use data-tool-type="unknown" data-tool-name="runSubagent">
<details>
<summary>Tool use: **runSubagent**</summary>

Additional data:

```json
{
  "vscodeToolId": "runSubagent",
  "isHidden": false
}
```
Result:

```json
{
  "invocationMessage": "Research SIGEA project context",
  "isConfirmed": {
    "type": 1
  },
  "content": "",
  "textEditContent": "",
  "toolCallResult": null
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="copilot_readFile">
<details>
<summary>Tool use: **copilot_readFile** • Reading [](file:///Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-BACK/SIGEA.sql)</summary>


Read [](file:///Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-BACK/SIGEA.sql)

</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="copilot_listDirectory">
<details>
<summary>Tool use: **copilot_listDirectory**</summary>


Parameters:

```json
{
  "file_path": "Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-BACK",
  "relativeWorkspacePath": "BD-2025-2-BACK"
}
```
Additional data:

```json
{
  "vscodeToolId": "copilot_listDirectory",
  "isHidden": false
}
```
Result:

```json
{
  "invocationMessage": "Reading [](file:///Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-BACK)",
  "pastTenseMessage": "Read [](file:///Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-BACK)",
  "isConfirmed": {
    "type": 1
  },
  "content": "",
  "textEditContent": "",
  "toolCallResult": null
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="copilot_findFiles">
<details>
<summary>Tool use: **copilot_findFiles**</summary>

Additional data:

```json
{
  "vscodeToolId": "copilot_findFiles",
  "isHidden": false
}
```
Result:

```json
{
  "invocationMessage": "Searching for files matching &#96;**/*.{js,ts,json}&#96;",
  "pastTenseMessage": "Searched for files matching &#96;**/*.{js,ts,json}&#96;, no matches",
  "resultDetails": [],
  "isConfirmed": {
    "type": 1
  },
  "content": "",
  "textEditContent": "",
  "toolCallResult": null
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="copilot_findFiles">
<details>
<summary>Tool use: **copilot_findFiles**</summary>

Additional data:

```json
{
  "vscodeToolId": "copilot_findFiles",
  "isHidden": false
}
```
Result:

```json
{
  "invocationMessage": "Searching for files matching &#96;**/package.json&#96;",
  "pastTenseMessage": "Searched for files matching &#96;**/package.json&#96;, no matches",
  "resultDetails": [],
  "isConfirmed": {
    "type": 1
  },
  "content": "",
  "textEditContent": "",
  "toolCallResult": null
}
```
Status: **completed**


</details>
</tool-use>

---

## Plan: SIGEA Node.js + PostgreSQL Backend

Criar um backend simples em Node.js com Express e PostgreSQL para o sistema SIGEA (gestão de notas escolares), cumprindo todos os requisitos da apresentação: CRUD de 3+ tabelas relacionadas, VIEW, PROCEDURE, TRIGGER e inserção de dado binário (foto).

### Steps

1. **Inicializar projeto Node.js** — Criar `package.json`, instalar Express, `pg` (node-postgres) e `multer` (upload de arquivos). Estrutura básica: `/src/routes`, `/src/controllers`, `/src/db`.

2. **Ajustar schema SQL** — Adicionar coluna `foto BYTEA` na tabela `aluno` em SIGEA.sql. Criar VIEW `vw_boletim_aluno`, PROCEDURE `sp_calcular_media_final` e TRIGGER `trg_validar_nota`.

3. **Implementar camada de persistência** — Criar módulo de conexão com PostgreSQL (`db/pool.js`) e queries parametrizadas para cada tabela.

4. **Desenvolver CRUD para 4 tabelas relacionadas** — Focar em `aluno`, `avaliacao`, `nota` e `turma_professor` (cadeia de relacionamentos do sistema de notas). Rotas: `POST`, `GET`, `PUT`, `DELETE`.

5. **Implementar upload de foto do aluno** — Endpoint `POST /alunos/:id/foto` usando multer para receber imagem e salvar como BYTEA no banco.

6. **Popular banco com dados de exemplo** — Inserir 5 registros em cada tabela via script SQL ou seed.

### Further Considerations

1. **Framework de frontend?** — Usar apenas API REST (testar com Postman/Insomnia) ou criar interface simples com HTML/JS? Recomendo: API + Postman para simplificar.

2. **Autenticação?** — Não é requisito do projeto. Recomendo: pular para manter simples.

3. **Ambiente de desenvolvimento** — Usar PostgreSQL local ou Docker? Recomendo: local se já tiver instalado, Docker se preferir isolamento.

---

_**User (2025-12-03 19:58Z)**_

Um detalhe, eu estou construindo o back-end, meu colega esta construindo o nosso front end que está nessa pasta aqui em angular "/Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-FRONT/BD-2025-2-FRONT"

vc pode olhar o src com as features, ainda não tem nenhuma view ou presentation feita, mas a gente vai construir o backend que vai comunicar as coisas pra ele.

não queor nenhum upload d efoto do aluno, a questao do dado binario, vamos colocar o pdf da prova.

autenticacao, não precisa de nada mt complexo, apenas o basico mesmo de hash de senha coisas que ja estão prontas.... vc pode usar frameworks e bibliotecas tbm pra que seja mais facil tudo, como prisma ou etc...

ambiente de desenvolvimento, podemos usar local ou docker, tenho as duas formas

pedrororiz@Pedros-MacBook-Air-2 BD-2025-2-FRONT % psql --version

psql (PostgreSQL) 17.2

---

_**Agent (model copilot/claude-opus-4.5)**_

<tool-use data-tool-type="unknown" data-tool-name="runSubagent">
<details>
<summary>Tool use: **runSubagent**</summary>

Additional data:

```json
{
  "vscodeToolId": "runSubagent",
  "isHidden": false
}
```
Result:

```json
{
  "invocationMessage": "Research Angular frontend structure",
  "isConfirmed": {
    "type": 1
  },
  "content": "",
  "textEditContent": "",
  "toolCallResult": null
}
```
Status: **completed**


</details>
</tool-use>

---

<tool-use data-tool-type="unknown" data-tool-name="copilot_listDirectory">
<details>
<summary>Tool use: **copilot_listDirectory**</summary>


Parameters:

```json
{
  "file_path": "Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-FRONT/BD-2025-2-FRONT/src",
  "relativeWorkspacePath": "src"
}
```
Additional data:

```json
{
  "vscodeToolId": "copilot_listDirectory",
  "isHidden": false
}
```
Result:

```json
{
  "invocationMessage": "Reading [](file:///Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-FRONT/BD-2025-2-FRONT/src)",
  "pastTenseMessage": "Read [](file:///Users/pedrororiz/Downloads/__UNB__/BD/BD-2025-2-FRONT/BD-2025-2-FRONT/src)",
  "isConfirmed": {
    "type": 1
  },
  "content": "",
  "textEditContent": "",
  "toolCallResult": null
}
```
Status: **completed**


</details>
</tool-use>

---

Não consegui acessar o projeto frontend Angular porque está fora do workspace atual. Mas posso prosseguir com o plano atualizado baseado nas suas preferências:

## Plan: SIGEA Node.js + PostgreSQL Backend (v2)

Backend em Node.js com Express, Prisma ORM e PostgreSQL para o sistema SIGEA. API REST que servirá o frontend Angular do seu colega. Inclui autenticação básica, CRUD de tabelas relacionadas, VIEW, PROCEDURE, TRIGGER e upload de PDF (prova).

### Steps

1. **Inicializar projeto Node.js com Prisma** — Criar estrutura com Express + Prisma ORM + bcrypt (hash de senha) + multer (upload PDF). Estrutura: `/src/routes`, `/src/controllers`, `/src/services`, `/prisma`.

2. **Configurar Prisma schema** — Mapear todas as tabelas do SIGEA.sql para o `schema.prisma`. Adicionar campo `arquivo_prova BYTEA` na tabela `avaliacao` para o PDF.

3. **Criar objetos SQL no banco** — Adicionar ao schema:
   - **VIEW** `vw_boletim_aluno` (notas por aluno/disciplina/período)
   - **PROCEDURE** `sp_calcular_media_final` (calcula média ponderada)
   - **TRIGGER** `trg_validar_nota` (valida nota entre 0-10 antes de inserir)

4. **Implementar autenticação básica** — Tabela `usuario` com email/senha (hash bcrypt). Endpoints `POST /auth/login` e `POST /auth/register`. JWT simples para proteger rotas.

5. **Desenvolver CRUD para 4+ tabelas relacionadas** — Endpoints REST para `aluno`, `turma`, `avaliacao`, `nota` (e auxiliares). Padronizar rotas: `GET/POST /api/alunos`, `PUT/DELETE /api/alunos/:id`.

6. **Implementar upload de PDF da prova** — Endpoint `POST /api/avaliacoes/:id/arquivo` usando multer. Salvar PDF como BYTEA na coluna `arquivo_prova`.

7. **Configurar CORS para Angular** — Habilitar CORS para `http://localhost:4200` (padrão Angular dev server).

8. **Popular banco com seed** — Script Prisma seed com 5+ registros por tabela.

### Further Considerations

1. **Quer que eu analise o frontend Angular?** — Adicione a pasta `` ao workspace para eu verificar a estrutura e alinhar os endpoints.

2. **PostgreSQL local ou Docker?** — Recomendo local já que você tem PostgreSQL 17.2 instalado. Basta criar o database: `createdb sigea`.

3. **Estrutura de pastas do backend** — Sugestão:
   ```
   /src
     /controllers   → lógica das rotas
     /routes        → definição das rotas Express
     /services      → regras de negócio
     /middlewares   → auth, upload, etc
   /prisma
     schema.prisma  → modelo do banco
     seed.ts        → dados de exemplo
   ```

---

